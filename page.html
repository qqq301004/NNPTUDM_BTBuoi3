<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω b√†i vi·∫øt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: "Segoe UI", Tahoma, sans-serif;
            background: #f4f6f8;
            padding: 20px;
            color: #333;
        }

        h2, h3 {
            margin-bottom: 12px;
        }

        /* TOOLBAR */
        .toolbar {
            background: #fff;
            padding: 14px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        input, select {
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            outline: none;
        }

        input:focus, select:focus {
            border-color: #4f46e5;
        }

        button {
            padding: 7px 12px;
            border-radius: 6px;
            border: none;
            background: #4f46e5;
            color: #fff;
            cursor: pointer;
        }

        button:hover {
            background: #4338ca;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* TABLE */
        .table-wrapper {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background: #111827;
            color: #fff;
        }

        tbody tr:nth-child(odd) {
            background: #f9fafb;
        }

        tbody tr:nth-child(even) {
            background: #fff;
        }

        tbody tr:hover {
            background: #eef2ff;
        }

        td {
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        img {
            width: 90px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        /* PAGINATION */
        #pagination button {
            margin: 0 3px;
            padding: 6px 10px;
            background: #e5e7eb;
            color: #111;
        }

        #pagination button:disabled {
            background: #4f46e5;
            color: #fff;
            font-weight: bold;
        }

        /* FORM */
        form {
            background: #fff;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
            max-width: 400px;
            margin-top: 20px;
        }

        form input {
            width: 100%;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>

<h2>üìÑ Qu·∫£n l√Ω s·∫£n ph·∫©m </h2>

<div class="toolbar">
    <input type="text" id="search-title" placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ...">

    <label>Hi·ªÉn th·ªã:</label>
    <select id="page-size">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="20">20</option>
    </select>

    <button id="sort-title-az">T√™n A‚ÜíZ</button>
    <button id="sort-title-za">T√™n Z‚ÜíA</button>
    <button id="sort-views-asc">Gi√° ‚Üë</button>
    <button id="sort-views-desc">Gi√° ‚Üì</button>

    <span id="pagination"></span>
</div>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>H√¨nh ·∫£nh</th>
                <th>Ti√™u ƒë·ªÅ</th>
                <th>Gi√°</th>
                <th>Danh m·ª•c</th>
                <th>M√¥ t·∫£</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="posts-tbody"></tbody>
    </table>
</div>

<h3>‚ûï Th√™m b√†i vi·∫øt m·ªõi</h3>

<form id="add-post-form">
    <input type="text" id="title" placeholder="Ti√™u ƒë·ªÅ" required>
    <input type="number" id="views" placeholder="Gi√° / L∆∞·ª£t xem" required>
    <button type="submit">Th√™m</button>
</form>

<script>
let allPosts = [];
let filteredPosts = [];
let currentPage = 1;
let pageSize = 10;
let currentSort = "";

const API = "http://localhost:3000/posts";

function renderTable() {
    const tbody = document.getElementById("posts-tbody");
    tbody.innerHTML = "";

    const start = (currentPage - 1) * pageSize;
    const pageData = filteredPosts.slice(start, start + pageSize);

    pageData.forEach(p => {
        const img = p.images?.[0] || "";
        const cat = p.category?.name || "";

        tbody.innerHTML += `
            <tr>
                <td>${p.id}</td>
                <td>${img ? `<img src="${img}">` : ""}</td>
                <td>${p.title || ""}</td>
                <td>${p.price ?? p.views ?? ""}</td>
                <td>${cat}</td>
                <td>${p.description || ""}</td>
                <td><button onclick="deletePost(${p.id})">X√≥a</button></td>
            </tr>
        `;
    });
}

function renderPagination() {
    const totalPages = Math.ceil(filteredPosts.length / pageSize) || 1;
    const pag = document.getElementById("pagination");
    pag.innerHTML = "";

    for (let i = 1; i <= totalPages; i++) {
        pag.innerHTML += `<button ${i===currentPage?"disabled":""} onclick="gotoPage(${i})">${i}</button>`;
    }
}

function gotoPage(p) {
    currentPage = p;
    renderTable();
    renderPagination();
}

function applySort() {
    if (currentSort === "title-az") filteredPosts.sort((a,b)=>a.title.localeCompare(b.title));
    if (currentSort === "title-za") filteredPosts.sort((a,b)=>b.title.localeCompare(a.title));
    if (currentSort === "views-asc") filteredPosts.sort((a,b)=>(a.views||0)-(b.views||0));
    if (currentSort === "views-desc") filteredPosts.sort((a,b)=>(b.views||0)-(a.views||0));
}

function loadPosts() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            allPosts = data;
            filteredPosts = [...data];
            applySort();
            renderTable();
            renderPagination();
        });
}

function deletePost(id) {
    if (!confirm("X√≥a b√†i vi·∫øt?")) return;
    fetch(`${API}/${id}`, { method: "DELETE" }).then(loadPosts);
}

document.getElementById("search-title").oninput = e => {
    const k = e.target.value.toLowerCase();
    filteredPosts = allPosts.filter(p => p.title?.toLowerCase().includes(k));
    currentPage = 1;
    applySort();
    renderTable();
    renderPagination();
};

document.getElementById("page-size").onchange = e => {
    pageSize = +e.target.value;
    currentPage = 1;
    renderTable();
    renderPagination();
};

document.getElementById("sort-title-az").onclick = () => { currentSort="title-az"; applySort(); renderTable(); };
document.getElementById("sort-title-za").onclick = () => { currentSort="title-za"; applySort(); renderTable(); };
document.getElementById("sort-views-asc").onclick = () => { currentSort="views-asc"; applySort(); renderTable(); };
document.getElementById("sort-views-desc").onclick = () => { currentSort="views-desc"; applySort(); renderTable(); };

document.getElementById("add-post-form").onsubmit = e => {
    e.preventDefault();
    fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            title: title.value,
            views: Number(views.value)
        })
    }).then(() => {
        e.target.reset();
        loadPosts();
    });
};

loadPosts();
</script>

</body>
</html>
